<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jadwal Sholat Depok (AUTO) - TV LG</title>
  <style>
    :root{
      --bg1:#071a24;
      --bg2:#030c12;
      --card:rgba(0,0,0,0.28);
      --border:rgba(255,255,255,0.12);
      --text:#eaf6ff;
      --muted:#b7d3e6;
      --accent:#46d6ff;
      --accent2:#66ffb3;
      --warn:#ffd166;
      --danger:#ff6464;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 600px at 20% 20%, #0d3b52 0%, var(--bg1) 35%, var(--bg2) 100%);
      height:100vh;
      overflow:hidden;
    }

    .wrap{
      height:100vh;
      padding:26px 34px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    .top{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:14px;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .brand .title{
      font-size:34px;
      font-weight:800;
      margin:0;
      letter-spacing:0.5px;
    }
    .brand .sub{
      color:var(--muted);
      font-size:16px;
      font-weight:700;
    }

    .clock{
      text-align:right;
      line-height:1.05;
    }
    .clock .time{
      font-size:78px;
      font-weight:900;
      letter-spacing:1px;
    }
    .clock .date{
      margin-top:6px;
      color:var(--muted);
      font-size:18px;
      font-weight:700;
    }

    .main{
      flex:1;
      display:grid;
      grid-template-columns: 1.2fr 1fr;
      gap:16px;
      min-height:0;
    }

    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius:22px;
      padding:18px;
      box-shadow: 0 16px 55px rgba(0,0,0,0.35);
      min-height:0;
    }

    .next{
      display:flex;
      flex-direction:column;
      gap:12px;
      height:100%;
    }

    .label{
      color:var(--muted);
      font-size:16px;
      font-weight:800;
    }

    .nextName{
      font-size:48px;
      font-weight:900;
      display:flex;
      gap:10px;
      align-items:baseline;
    }

    .pill{
      font-size:14px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.22);
      color: var(--muted);
      font-weight:800;
    }

    .countdown{
      font-size:58px;
      font-weight:900;
      color: var(--accent2);
      letter-spacing:1px;
    }

    .statusBox{
      margin-top:auto;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }

    .mini{
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.25);
      overflow:hidden;
    }
    .mini .k{
      font-size:13px;
      color:var(--muted);
      font-weight:800;
      margin-bottom:6px;
    }
    .mini .v{
      font-size:18px;
      font-weight:900;
    }

    .schedule h2{
      margin:0 0 12px 0;
      color:var(--muted);
      font-size:22px;
      font-weight:900;
    }

    .rows{
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:hidden;
    }

    .row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:14px 16px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.22);
      font-size:22px;
    }

    .row .name{
      font-weight:900;
      letter-spacing:0.2px;
    }
    .row .t{
      font-weight:900;
      font-size:26px;
      color: var(--accent);
    }

    .row.active{
      border-color: rgba(102,255,179,0.55);
      background: rgba(102,255,179,0.10);
      box-shadow: 0 0 0 3px rgba(102,255,179,0.08);
    }
    .row.active .t{ color: var(--accent2); }

    .row.now{
      border-color: rgba(255,209,102,0.70);
      background: rgba(255,209,102,0.10);
      box-shadow: 0 0 0 3px rgba(255,209,102,0.08);
    }
    .row.now .t{ color: var(--warn); }

    .footer{
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.25);
      overflow:hidden;
    }

    .marqueeWrap{
      width:100%;
      overflow:hidden;
      padding:10px 0;
    }

    .marquee{
      white-space:nowrap;
      display:inline-block;
      font-size:18px;
      font-weight:900;
      padding-left:100%;
      animation: scroll 30s linear infinite;
    }

    @keyframes scroll{
      0%{ transform: translateX(0%); }
      100%{ transform: translateX(-200%); }
    }

    /* ====== IQOMAH FULLSCREEN ====== */
    .overlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,0.78);
      backdrop-filter: blur(4px);
      z-index:9999;
      padding:26px;
    }
    .overlay.show{ display:flex; }

    .overlayCard{
      width:min(920px, 92vw);
      border-radius:28px;
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(10,20,28,0.72);
      box-shadow: 0 30px 100px rgba(0,0,0,0.55);
      padding:28px;
      text-align:center;
    }

    .overlayTitle{
      font-size:40px;
      font-weight:1000;
      margin:0 0 6px 0;
      letter-spacing:0.5px;
    }

    .overlaySub{
      margin:0 0 18px 0;
      font-size:18px;
      color: var(--muted);
      font-weight:800;
    }

    .overlayTimer{
      font-size:92px;
      font-weight:1100;
      color: var(--danger);
      letter-spacing:2px;
      margin: 6px 0 14px 0;
    }

    .overlayNote{
      font-size:20px;
      font-weight:900;
      color: var(--warn);
    }

    .smallNote{
      color: rgba(255,255,255,0.55);
      font-size:12px;
      position:fixed;
      right:14px;
      top:12px;
      z-index:10000;
    }
  </style>
</head>
<body>
  <div class="smallNote">AUTO ‚Ä¢ Depok ‚Ä¢ LG Smart TV</div>

  <div class="overlay" id="iqomahOverlay">
    <div class="overlayCard">
      <h1 class="overlayTitle" id="iqTitle">IQOMAH</h1>
      <p class="overlaySub" id="iqSub">Persiapan Sholat</p>
      <div class="overlayTimer" id="iqTimer">00:00</div>
      <div class="overlayNote">Mohon rapikan shaf & matikan HP (silent)</div>
    </div>
  </div>

  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="title">Jadwal Sholat</div>
        <div class="sub" id="locText">Depok ‚Ä¢ Jawa Barat</div>
      </div>

      <div class="clock">
        <div class="time" id="timeText">00:00:00</div>
        <div class="date" id="dateText">-</div>
      </div>
    </div>

    <div class="main">
      <div class="card next">
        <div class="label">Sholat berikutnya</div>

        <div class="nextName">
          <span id="nextPrayerName">-</span>
          <span class="pill" id="nextPrayerTime">--:--</span>
        </div>

        <div class="label">Hitung mundur</div>
        <div class="countdown" id="countdownText">--:--:--</div>

        <div class="statusBox">
          <div class="mini">
            <div class="k">Status</div>
            <div class="v" id="statusText">Memuat jadwal...</div>
          </div>
          <div class="mini">
            <div class="k">Info</div>
            <div class="v" id="messageText">Mohon tunggu</div>
          </div>
        </div>
      </div>

      <div class="card schedule">
        <h2>Jadwal Hari Ini</h2>
        <div class="rows" id="rows"></div>
      </div>
    </div>

    <div class="footer">
      <div class="marqueeWrap">
        <div class="marquee" id="marqueeText">
          üìå Mohon matikan HP / silent ‚Ä¢ Rapikan shaf ‚Ä¢ Anak-anak harap didampingi orang tua ‚Ä¢ Barakallahu fiikum ü§ç
        </div>
      </div>
    </div>
  </div>

<script>
  // ============================
  // KONFIGURASI UTAMA
  // ============================
  const CONFIG = {
    city: "Depok",
    country: "Indonesia",
    locationText: "Depok ‚Ä¢ Jawa Barat",
    // Metode perhitungan (umum): 11 = Indonesia (bisa beda, tapi ini cukup aman)
    method: 11,

    activeWindowMinutes: 10, // highlight "waktu sholat" setelah adzan (menit)

    marqueeText:
      "üìå Mohon matikan HP / silent ‚Ä¢ Rapikan shaf ‚Ä¢ Anak-anak harap didampingi orang tua ‚Ä¢ Rapikan sandal di rak ‚Ä¢ Barakallahu fiikum ü§ç",

    iqomahMinutes: {
      "Subuh": 10,
      "Dzuhur": 10,
      "Ashar": 10,
      "Maghrib": 8,
      "Isya": 10
    }
  };

  // ============================
  // STATE
  // ============================
  let SCHEDULE = null; // {Subuh:"04:xx", Dzuhur:"12:xx", ...}
  let LAST_FETCH_DATE = null; // "YYYY-MM-DD"

  document.getElementById("locText").textContent = CONFIG.locationText;
  document.getElementById("marqueeText").textContent = CONFIG.marqueeText;

  const rowsEl = document.getElementById("rows");
  const overlay = document.getElementById("iqomahOverlay");

  // ============================
  // UTIL
  // ============================
  function pad(n){ return String(n).padStart(2,"0"); }

  function formatDate(d){
    const hari = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
    const bulan = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
    return `${hari[d.getDay()]}, ${d.getDate()} ${bulan[d.getMonth()]} ${d.getFullYear()}`;
  }

  function ymd(d){
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  }

  function cleanTime(t){
    // API kadang mengembalikan "04:36 (WIB)" ‚Üí kita ambil HH:MM saja
    if(!t) return null;
    const m = t.match(/\d{2}:\d{2}/);
    return m ? m[0] : t;
  }

  function parseTimeToDate(baseDate, hhmm){
    const [hh, mm] = hhmm.split(":").map(Number);
    const d = new Date(baseDate);
    d.setHours(hh, mm, 0, 0);
    return d;
  }

  function secondsToHHMMSS(totalSec){
    const sec = Math.max(0, Math.floor(totalSec));
    const hh = Math.floor(sec / 3600);
    const mm = Math.floor((sec % 3600) / 60);
    const ss = sec % 60;
    return `${pad(hh)}:${pad(mm)}:${pad(ss)}`;
  }

  function secondsToMMSS(totalSec){
    const sec = Math.max(0, Math.floor(totalSec));
    const mm = Math.floor(sec / 60);
    const ss = sec % 60;
    return `${pad(mm)}:${pad(ss)}`;
  }

  // ============================
  // FETCH JADWAL OTOMATIS (ALADHAN)
  // ============================
  async function fetchScheduleForToday(){
    const now = new Date();
    const todayStr = ymd(now);

    // sudah fetch hari ini ‚Üí skip
    if(LAST_FETCH_DATE === todayStr && SCHEDULE) return;

    const url =
      `https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(CONFIG.city)}&country=${encodeURIComponent(CONFIG.country)}&method=${CONFIG.method}`;

    try{
      document.getElementById("statusText").textContent = "Memuat jadwal...";
      document.getElementById("messageText").textContent = "Mengambil data Depok";

      const res = await fetch(url, { cache: "no-store" });
      const json = await res.json();

      const t = json?.data?.timings;
      if(!t) throw new Error("Data timings tidak ditemukan");

      // Mapping ke nama yang kita pakai
      SCHEDULE = {
        "Subuh": cleanTime(t.Fajr),
        "Dzuhur": cleanTime(t.Dhuhr),
        "Ashar": cleanTime(t.Asr),
        "Maghrib": cleanTime(t.Maghrib),
        "Isya": cleanTime(t.Isha)
      };

      LAST_FETCH_DATE = todayStr;

      renderRows();
      document.getElementById("statusText").textContent = "Siap";
      document.getElementById("messageText").textContent = "Solatlah seperti nabi solat";
    } catch(err){
      console.log(err);
      document.getElementById("statusText").textContent = "Gagal memuat";
      document.getElementById("messageText").textContent = "Cek koneksi internet TV ‚ö†Ô∏è";
    }
  }

  // ============================
  // RENDER JADWAL
  // ============================
  function getScheduleList(){
    if(!SCHEDULE){
      // fallback tampilan kosong
      return [
        { key:"Subuh", time:"--:--" },
        { key:"Dzuhur", time:"--:--" },
        { key:"Ashar", time:"--:--" },
        { key:"Maghrib", time:"--:--" },
        { key:"Isya", time:"--:--" },
      ];
    }
    return [
      { key:"Subuh", time:SCHEDULE.Subuh },
      { key:"Dzuhur", time:SCHEDULE.Dzuhur },
      { key:"Ashar", time:SCHEDULE.Ashar },
      { key:"Maghrib", time:SCHEDULE.Maghrib },
      { key:"Isya", time:SCHEDULE.Isya },
    ];
  }

  function renderRows(){
    const list = getScheduleList();
    rowsEl.innerHTML = "";
    list.forEach(p => {
      const div = document.createElement("div");
      div.className = "row";
      div.dataset.key = p.key;
      div.innerHTML = `<div class="name">${p.key}</div><div class="t">${p.time}</div>`;
      rowsEl.appendChild(div);
    });
  }

  // ============================
  // LOGIC NEXT PRAYER + IQOMAH
  // ============================
  function getNextPrayer(now){
    const list = getScheduleList().filter(x => x.time && x.time !== "--:--");

    // Jadwal hari ini
    const today = new Date(now);
    const times = list.map(p => ({...p, date: parseTimeToDate(today, p.time)}));

    for (const t of times){
      if (t.date > now) return t;
    }

    // kalau sudah lewat semua ‚Üí Subuh besok
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);

    const subuh = list[0]; // Subuh
    return {...subuh, date: parseTimeToDate(tomorrow, subuh.time)};
  }

  function getActivePrayer(now){
    const list = getScheduleList().filter(x => x.time && x.time !== "--:--");
    const today = new Date(now);
    const times = list.map(p => ({...p, date: parseTimeToDate(today, p.time)}));

    for (const t of times){
      const end = new Date(t.date.getTime() + CONFIG.activeWindowMinutes * 60 * 1000);
      if (now >= t.date && now <= end) return t;
    }
    return null;
  }

  function getIqomahState(now){
    // Jika sedang dalam window setelah adzan sampai iqomah -> tampilkan overlay countdown
    const active = getActivePrayer(now);
    if(!active) return null;

    const minutes = CONFIG.iqomahMinutes[active.key];
    if(!minutes) return null;

    const iqomahAt = new Date(active.date.getTime() + minutes * 60 * 1000);
    if(now <= iqomahAt){
      return {
        prayer: active.key,
        untilSeconds: Math.floor((iqomahAt - now)/1000),
        iqomahTime: iqomahAt
      };
    }
    return null;
  }

  // ============================
  // UPDATE UI
  // ============================
  function updateUI(){
    const now = new Date();

    document.getElementById("timeText").textContent =
      `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
    document.getElementById("dateText").textContent = formatDate(now);

    // Reset highlight
    document.querySelectorAll(".row").forEach(r => r.classList.remove("active","now"));

    // IQOMAH overlay logic
    const iq = getIqomahState(now);
    if(iq){
      overlay.classList.add("show");
      document.getElementById("iqTitle").textContent = `IQOMAH ${iq.prayer}`;
      document.getElementById("iqSub").textContent = `Sholat ${iq.prayer} akan dimulai`;
      document.getElementById("iqTimer").textContent = secondsToMMSS(iq.untilSeconds);

      // Status box
      document.getElementById("statusText").textContent = `Menunggu IQOMAH`;
      document.getElementById("messageText").textContent = `${iq.prayer} ‚Ä¢ ${CONFIG.iqomahMinutes[iq.prayer]} menit setelah adzan`;

      // highlight baris sholat yg active
      const row = document.querySelector(`.row[data-key="${iq.prayer}"]`);
      if(row) row.classList.add("now");

      // Next prayer panel tetap update normal (optional)
    } else {
      overlay.classList.remove("show");
    }

    // Next prayer + countdown
    const next = getNextPrayer(now);
    document.getElementById("nextPrayerName").textContent = next.key || "-";
    document.getElementById("nextPrayerTime").textContent = next.time || "--:--";

    const diffSec = Math.max(0, Math.floor((next.date - now)/1000));
    document.getElementById("countdownText").textContent = secondsToHHMMSS(diffSec);

    // Jika tidak IQOMAH overlay -> tampilkan status biasa
    if(!iq){
      const active = getActivePrayer(now);
      if(active){
        document.getElementById("statusText").textContent = `Waktu ${active.key}`;
        document.getElementById("messageText").textContent = `Siapkan diri ‚Ä¢ IQOMAH ${CONFIG.iqomahMinutes[active.key] || "-"} menit`;

        const row = document.querySelector(`.row[data-key="${active.key}"]`);
        if(row) row.classList.add("now");
      } else {
        document.getElementById("statusText").textContent = `Menuju ${next.key}`;
        document.getElementById("messageText").textContent = "Persiapkan diri & rapikan shaf ü§ç";

        const row = document.querySelector(`.row[data-key="${next.key}"]`);
        if(row) row.classList.add("active");
      }
    }
  }

  // ============================
  // INIT
  // ============================
  renderRows();

  // Load jadwal otomatis saat start
  fetchScheduleForToday();

  // Auto refresh jadwal setiap 30 menit (atau saat ganti hari)
  setInterval(fetchScheduleForToday, 30 * 60 * 1000);

  // Update UI per detik
  updateUI();
  setInterval(updateUI, 1000);

  // Extra: refetch jadwal saat jam 00:01 (ganti hari)
  setInterval(() => {
    const now = new Date();
    if(now.getHours() === 0 && now.getMinutes() === 1 && now.getSeconds() < 3){
      LAST_FETCH_DATE = null;
      fetchScheduleForToday();
    }
  }, 1000);
</script>
</body>
</html>

